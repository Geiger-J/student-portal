<!DOCTYPE html>
<!--
Reusable header fragments for consistent site navigation and styling.
Provides responsive navigation with consolidated menu structure.
Includes admin dropdown, user authentication state, and semantic markup.
Supports both authenticated and anonymous user experiences.
-->
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/extras/spring-security">
<head th:fragment="head">
    <meta charset="UTF-8"/>
    <title th:text="${title} ?: 'Student Portal'">Student Portal</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}" href="/css/styles.css"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
<header class="header" th:fragment="header">
    <div class="container header-flex">
        <h1 class="site-title">
            <a th:href="@{/dashboard}" sec:authorize="isAuthenticated()">ğŸ“ Bromsgrove Student Portal</a>
            <a th:href="@{/}" sec:authorize="isAnonymous()">ğŸ“ Bromsgrove Student Portal</a>
        </h1>

        <nav class="main-nav" sec:authorize="isAuthenticated()">
            <a th:href="@{/dashboard}" th:classappend="${#httpServletRequest.requestURI == '/dashboard'} ? 'active' : ''">ğŸ“Š Dashboard</a>
            <a th:href="@{/profile}" th:classappend="${#strings.startsWith(#httpServletRequest.requestURI, '/profile')} ? 'active' : ''">ğŸ‘¤ Profile</a>
            <a th:href="@{/subjects}" th:classappend="${#strings.startsWith(#httpServletRequest.requestURI, '/subjects')} ? 'active' : ''">ğŸ“š Subjects</a>

            <div sec:authorize="hasRole('ADMIN')" class="admin-dropdown">
                <a href="#" class="dropdown-toggle" onclick="toggleDropdown(event)">âš™ï¸ Admin â–¼</a>
                <div class="dropdown-menu">
                    <a th:href="@{/admin}">ğŸ“ˆ Overview</a>
                    <a th:href="@{/admin/matching}">ğŸš€ Matching</a>
                    <a th:href="@{/subjects/admin}">ğŸ“š Manage Subjects</a>
                </div>
            </div>

            <form th:action="@{/logout}" method="post" class="logout-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="logout-btn">ğŸšª Logout</button>
            </form>
        </nav>

        <nav class="main-nav" sec:authorize="isAnonymous()">
            <a class="auth-btn" th:href="@{/login}">ğŸ” Sign In</a>
            <a class="auth-btn primary" th:href="@{/register}">ğŸ“ Register</a>
        </nav>
    </div>
</header>

<script th:inline="javascript">
function toggleDropdown(e){
  e.preventDefault();
  const root = e.target.closest('.admin-dropdown');
  const menu = root.querySelector('.dropdown-menu');
  menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
  document.addEventListener('click', function handler(ev){
    if(!root.contains(ev.target)){
      menu.style.display='none';
      document.removeEventListener('click', handler);
    }
  });
}
</script>
</body>
</html>