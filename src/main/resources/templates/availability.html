<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body>
<header th:replace="fragments/header :: header"></header>

<main class="container">
    <h2>Manage Availability</h2>
    
    <!-- Success/Error Messages -->
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
    
    <p>Select the time slots when you are available for tutoring sessions. The matching algorithm will use this information to find suitable partners.</p>
    
    <!-- Availability Grid -->
    <form th:action="@{/availability/bulk-update}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div class="availability-grid">
            <table class="table availability-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Monday</th>
                        <th>Tuesday</th>
                        <th>Wednesday</th>
                        <th>Thursday</th>
                        <th>Friday</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="period : ${periods}">
                        <td class="time-label" th:text="'Period ' + ${period.name().substring(1)}">Period 1</td>
                        <td th:each="day : ${weekdays}">
                            <input type="checkbox" 
                                   th:name="slots" 
                                   th:value="${day.name()} + '_' + ${period.name()}"
                                   th:checked="${availabilitySlots.stream().anyMatch(slot -> slot.dayOfWeek.name() == day.name() && slot.period.name() == period.name())}"
                                   class="availability-checkbox" />
                            <label th:for="${'slot_' + day.name() + '_' + period.name()}" class="sr-only">
                                <span th:text="${day.name()} + ' ' + ${period.name()}">Monday P1</span>
                            </label>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="form-actions" style="margin-top: 16px;">
            <button type="submit" class="btn">Update Availability</button>
            <form th:action="@{/availability/clear}" method="post" style="display: inline-block;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <button type="submit" class="btn btn-danger" 
                        onclick="return confirm('Are you sure you want to clear all availability?')">Clear All</button>
            </form>
        </div>
    </form>
    
    <!-- Current Availability Summary -->
    <div class="availability-summary" style="margin-top: 32px;">
        <h3>Current Availability Summary</h3>
        
        <div th:if="${#lists.isEmpty(availabilitySlots)}">
            <p class="alert alert-warning">No availability slots set. Please select your available times above.</p>
        </div>
        
        <div th:if="${!#lists.isEmpty(availabilitySlots)}">
            <p>You are available for <strong th:text="${#lists.size(availabilitySlots)}">5</strong> time slots per week:</p>
            
            <div class="availability-list" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px;">
                <span th:each="slot : ${availabilitySlots}" 
                      class="badge availability-badge"
                      th:text="${#strings.capitalize(#strings.toLowerCase(slot.dayOfWeek.name()))} + ' Period ' + ${slot.period.name().substring(1)}">
                    Monday Period 1
                </span>
            </div>
        </div>
    </div>
    
    <!-- Tips Section -->
    <div class="tips-section" style="margin-top: 32px; padding: 16px; background: #f9f9f9; border-radius: 8px;">
        <h4>üí° Tips for Setting Availability</h4>
        <ul>
            <li><strong>Be realistic:</strong> Only select times when you can consistently attend sessions</li>
            <li><strong>More slots = better matches:</strong> The more availability you provide, the more likely you'll find suitable matches</li>
            <li><strong>Consider your schedule:</strong> Make sure you don't have other commitments during selected times</li>
            <li><strong>Update regularly:</strong> Keep your availability current as your schedule changes</li>
        </ul>
    </div>
    
    <!-- Navigation -->
    <div class="navigation-section" style="margin-top: 24px;">
        <a th:href="@{/dashboard}" class="btn">‚Üê Back to Dashboard</a>
        <a th:href="@{/profile}" class="btn">Update Profile</a>
        <a th:href="@{/requests}" class="btn">Manage Requests</a>
    </div>
</main>

<footer th:replace="fragments/layout :: footer"></footer>

<style>
/* Availability-specific styles */
.availability-table {
    font-size: 14px;
}

.availability-table td {
    text-align: center;
    padding: 12px 8px;
}

.time-label {
    font-weight: bold;
    background: #f5f5f5;
    text-align: left !important;
}

.availability-checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.availability-checkbox:checked {
    accent-color: #8b0000;
}

.availability-badge {
    background: #8b0000;
    color: white;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
}

.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Responsive design */
@media (max-width: 768px) {
    .availability-table {
        font-size: 12px;
    }
    
    .availability-table td {
        padding: 8px 4px;
    }
    
    .availability-checkbox {
        width: 16px;
        height: 16px;
    }
}
</style>

</body>
</html>