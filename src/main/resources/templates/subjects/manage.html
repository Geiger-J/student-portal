<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head('Manage Subjects - Student Portal', null)}"></head>
<body>
<header th:replace="~{fragments/header :: header}"></header>
<main class="container">
    <h2>Manage Your Subjects</h2>

    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <p>Select the subjects you study or can tutor.</p>

    <form th:action="@{/subjects/update}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
        <div class="subjects-grid" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:24px;">
            <div th:each="subject : ${allSubjects}" class="subject-item" style="background:white;padding:12px;border:1px solid #ddd;border-radius:8px;">
                <label style="display:flex;align-items:center;cursor:pointer;margin:0;">
                    <input type="checkbox"
                           name="subjectIds"
                           th:value="${subject.id}"
                           th:checked="${userSubjectIds.contains(subject.id)}"
                           style="margin-right:8px;width:16px;height:16px;"/>
                    <span th:text="${subject.name}" style="font-weight:500;">Subject</span>
                </label>
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn">Update My Subjects</button>
            <a th:href="@{/dashboard}" class="btn" style="background:#6c757d;margin-left:8px;">Cancel</a>
        </div>
    </form>

    <div class="current-subjects" style="margin-top:32px;">
        <h3>Your Current Subjects</h3>
        <div th:if="${#lists.isEmpty(user.subjects)}">
            <p class="alert alert-warning">No subjects selected yet.</p>
        </div>
        <div th:if="${!#lists.isEmpty(user.subjects)}">
            <p>You have selected <strong th:text="${#lists.size(user.subjects)}">0</strong> subjects:</p>
            <div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;">
                <span th:each="subject : ${user.subjects}"
                      class="badge subject-badge"
                      th:text="${subject.name}">Subject</span>
            </div>
        </div>
    </div>

    <div style="margin-top:24px;">
        <a th:href="@{/dashboard}" class="btn">‚Üê Back to Dashboard</a>
        <a th:href="@{/profile}" class="btn">Update Profile</a>
        <a th:href="@{/availability}" class="btn">Set Availability</a>
    </div>
</main>
</body>
</html>